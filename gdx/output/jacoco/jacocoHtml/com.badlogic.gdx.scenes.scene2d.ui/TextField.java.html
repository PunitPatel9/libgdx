<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TextField.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">gdx</a> &gt; <a href="index.source.html" class="el_package">com.badlogic.gdx.scenes.scene2d.ui</a> &gt; <span class="el_source">TextField.java</span></div><h1>TextField.java</h1><pre class="source lang-java linenums">/*******************************************************************************
 * Copyright 2011 See AUTHORS file.
 * 
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *   http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/

package com.badlogic.gdx.scenes.scene2d.ui;

import com.badlogic.gdx.Gdx;
import com.badlogic.gdx.Input;
import com.badlogic.gdx.Input.Keys;
import com.badlogic.gdx.graphics.Color;
import com.badlogic.gdx.graphics.g2d.Batch;
import com.badlogic.gdx.graphics.g2d.BitmapFont;
import com.badlogic.gdx.graphics.g2d.BitmapFont.BitmapFontData;
import com.badlogic.gdx.graphics.g2d.GlyphLayout;
import com.badlogic.gdx.graphics.g2d.GlyphLayout.GlyphRun;
import com.badlogic.gdx.math.MathUtils;
import com.badlogic.gdx.math.Vector2;
import com.badlogic.gdx.scenes.scene2d.Actor;
import com.badlogic.gdx.scenes.scene2d.Group;
import com.badlogic.gdx.scenes.scene2d.InputEvent;
import com.badlogic.gdx.scenes.scene2d.InputListener;
import com.badlogic.gdx.scenes.scene2d.Stage;
import com.badlogic.gdx.scenes.scene2d.utils.ChangeListener.ChangeEvent;
import com.badlogic.gdx.scenes.scene2d.utils.ClickListener;
import com.badlogic.gdx.scenes.scene2d.utils.Disableable;
import com.badlogic.gdx.scenes.scene2d.utils.Drawable;
import com.badlogic.gdx.scenes.scene2d.utils.FocusListener;
import com.badlogic.gdx.scenes.scene2d.utils.UIUtils;
import com.badlogic.gdx.utils.Align;
import com.badlogic.gdx.utils.Array;
import com.badlogic.gdx.utils.Clipboard;
import com.badlogic.gdx.utils.FloatArray;
import com.badlogic.gdx.utils.Pools;
import com.badlogic.gdx.utils.Timer;
import com.badlogic.gdx.utils.Timer.Task;

/** A single-line text input field.
 * &lt;p&gt;
 * The preferred height of a text field is the height of the {@link TextFieldStyle#font} and {@link TextFieldStyle#background}.
 * The preferred width of a text field is 150, a relatively arbitrary size.
 * &lt;p&gt;
 * The text field will copy the currently selected text when ctrl+c is pressed, and paste any text in the clipboard when ctrl+v is
 * pressed. Clipboard functionality is provided via the {@link Clipboard} interface. Currently there are two standard
 * implementations, one for the desktop and one for Android. The Android clipboard is a stub, as copy &amp; pasting on Android is not
 * supported yet.
 * &lt;p&gt;
 * The text field allows you to specify an {@link OnscreenKeyboard} for displaying a softkeyboard and piping all key events
 * generated by the keyboard to the text field. There are two standard implementations, one for the desktop and one for Android.
 * The desktop keyboard is a stub, as a softkeyboard is not needed on the desktop. The Android {@link OnscreenKeyboard}
 * implementation will bring up the default IME.
 * @author mzechner
 * @author Nathan Sweet */
public class TextField extends Widget implements Disableable {
	static private final char BACKSPACE = 8;
	static protected final char ENTER_DESKTOP = '\r';
	static protected final char ENTER_ANDROID = '\n';
	static private final char TAB = '\t';
	static private final char DELETE = 127;
	static private final char BULLET = 149;

<span class="nc" id="L73">	static private final Vector2 tmp1 = new Vector2();</span>
<span class="nc" id="L74">	static private final Vector2 tmp2 = new Vector2();</span>
<span class="nc" id="L75">	static private final Vector2 tmp3 = new Vector2();</span>

<span class="nc" id="L77">	static public float keyRepeatInitialTime = 0.4f;</span>
<span class="nc" id="L78">	static public float keyRepeatTime = 0.1f;</span>

	protected String text;
	protected int cursor, selectionStart;
	protected boolean hasSelection;
	protected boolean writeEnters;
<span class="nc" id="L84">	protected final GlyphLayout layout = new GlyphLayout();</span>
<span class="nc" id="L85">	protected final FloatArray glyphPositions = new FloatArray();</span>

	TextFieldStyle style;
	private String messageText;
	protected CharSequence displayText;
	Clipboard clipboard;
	InputListener inputListener;
	TextFieldListener listener;
	TextFieldFilter filter;
<span class="nc" id="L94">	OnscreenKeyboard keyboard = new DefaultOnscreenKeyboard();</span>
<span class="nc" id="L95">	boolean focusTraversal = true, onlyFontChars = true, disabled;</span>
<span class="nc" id="L96">	private int textHAlign = Align.left;</span>
	private float selectionX, selectionWidth;

<span class="nc" id="L99">	String undoText = &quot;&quot;;</span>
	long lastChangeTime;

	boolean passwordMode;
	private StringBuilder passwordBuffer;
<span class="nc" id="L104">	private char passwordCharacter = BULLET;</span>

	protected float fontOffset, textHeight, textOffset;
	float renderOffset;
	private int visibleTextStart, visibleTextEnd;
<span class="nc" id="L109">	private int maxLength = 0;</span>

	boolean focused;
	boolean cursorOn;
<span class="nc" id="L113">	float blinkTime = 0.32f;</span>
<span class="nc" id="L114">	final Task blinkTask = new Task() {</span>
		public void run () {
<span class="nc bnc" id="L116" title="All 2 branches missed.">			if (getStage() == null) {</span>
<span class="nc" id="L117">				cancel();</span>
<span class="nc" id="L118">				return;</span>
			}
<span class="nc bnc" id="L120" title="All 2 branches missed.">			cursorOn = !cursorOn;</span>
<span class="nc" id="L121">			Gdx.graphics.requestRendering();</span>
<span class="nc" id="L122">		}</span>
	};

<span class="nc" id="L125">	final KeyRepeatTask keyRepeatTask = new KeyRepeatTask();</span>
	boolean programmaticChangeEvents;

	public TextField (String text, Skin skin) {
<span class="nc" id="L129">		this(text, skin.get(TextFieldStyle.class));</span>
<span class="nc" id="L130">	}</span>

	public TextField (String text, Skin skin, String styleName) {
<span class="nc" id="L133">		this(text, skin.get(styleName, TextFieldStyle.class));</span>
<span class="nc" id="L134">	}</span>

<span class="nc" id="L136">	public TextField (String text, TextFieldStyle style) {</span>
<span class="nc" id="L137">		setStyle(style);</span>
<span class="nc" id="L138">		clipboard = Gdx.app.getClipboard();</span>
<span class="nc" id="L139">		initialize();</span>
<span class="nc" id="L140">		setText(text);</span>
<span class="nc" id="L141">		setSize(getPrefWidth(), getPrefHeight());</span>
<span class="nc" id="L142">	}</span>

	protected void initialize () {
<span class="nc" id="L145">		addListener(inputListener = createInputListener());</span>
<span class="nc" id="L146">	}</span>

	protected InputListener createInputListener () {
<span class="nc" id="L149">		return new TextFieldClickListener();</span>
	}

	protected int letterUnderCursor (float x) {
<span class="nc" id="L153">		x -= textOffset + fontOffset - style.font.getData().cursorX - glyphPositions.get(visibleTextStart);</span>
<span class="nc" id="L154">		Drawable background = getBackgroundDrawable();</span>
<span class="nc bnc" id="L155" title="All 2 branches missed.">		if (background != null) x -= style.background.getLeftWidth();</span>
<span class="nc" id="L156">		int n = this.glyphPositions.size;</span>
<span class="nc" id="L157">		float[] glyphPositions = this.glyphPositions.items;</span>
<span class="nc bnc" id="L158" title="All 2 branches missed.">		for (int i = 1; i &lt; n; i++) {</span>
<span class="nc bnc" id="L159" title="All 2 branches missed.">			if (glyphPositions[i] &gt; x) {</span>
<span class="nc bnc" id="L160" title="All 2 branches missed.">				if (glyphPositions[i] - x &lt;= x - glyphPositions[i - 1]) return i;</span>
<span class="nc" id="L161">				return i - 1;</span>
			}
		}
<span class="nc" id="L164">		return n - 1;</span>
	}

	protected boolean isWordCharacter (char c) {
<span class="nc" id="L168">		return Character.isLetterOrDigit(c);</span>
	}

	protected int[] wordUnderCursor (int at) {
<span class="nc" id="L172">		String text = this.text;</span>
<span class="nc" id="L173">		int start = at, right = text.length(), left = 0, index = start;</span>
<span class="nc bnc" id="L174" title="All 2 branches missed.">		if (at &gt;= text.length()) {</span>
<span class="nc" id="L175">			left = text.length();</span>
<span class="nc" id="L176">			right = 0;</span>
		} else {
<span class="nc bnc" id="L178" title="All 2 branches missed.">			for (; index &lt; right; index++) {</span>
<span class="nc bnc" id="L179" title="All 2 branches missed.">				if (!isWordCharacter(text.charAt(index))) {</span>
<span class="nc" id="L180">					right = index;</span>
<span class="nc" id="L181">					break;</span>
				}
			}
<span class="nc bnc" id="L184" title="All 2 branches missed.">			for (index = start - 1; index &gt; -1; index--) {</span>
<span class="nc bnc" id="L185" title="All 2 branches missed.">				if (!isWordCharacter(text.charAt(index))) {</span>
<span class="nc" id="L186">					left = index + 1;</span>
<span class="nc" id="L187">					break;</span>
				}
			}
		}
<span class="nc" id="L191">		return new int[] {left, right};</span>
	}

	int[] wordUnderCursor (float x) {
<span class="nc" id="L195">		return wordUnderCursor(letterUnderCursor(x));</span>
	}

	boolean withinMaxLength (int size) {
<span class="nc bnc" id="L199" title="All 4 branches missed.">		return maxLength &lt;= 0 || size &lt; maxLength;</span>
	}

	public void setMaxLength (int maxLength) {
<span class="nc" id="L203">		this.maxLength = maxLength;</span>
<span class="nc" id="L204">	}</span>

	public int getMaxLength () {
<span class="nc" id="L207">		return this.maxLength;</span>
	}

	/** When false, text set by {@link #setText(String)} may contain characters not in the font, a space will be displayed instead.
	 * When true (the default), characters not in the font are stripped by setText. Characters not in the font are always stripped
	 * when typed or pasted. */
	public void setOnlyFontChars (boolean onlyFontChars) {
<span class="nc" id="L214">		this.onlyFontChars = onlyFontChars;</span>
<span class="nc" id="L215">	}</span>

	public void setStyle (TextFieldStyle style) {
<span class="nc bnc" id="L218" title="All 2 branches missed.">		if (style == null) throw new IllegalArgumentException(&quot;style cannot be null.&quot;);</span>
<span class="nc" id="L219">		this.style = style;</span>
<span class="nc" id="L220">		textHeight = style.font.getCapHeight() - style.font.getDescent() * 2;</span>
<span class="nc" id="L221">		invalidateHierarchy();</span>
<span class="nc" id="L222">	}</span>

	/** Returns the text field's style. Modifying the returned style may not have an effect until {@link #setStyle(TextFieldStyle)}
	 * is called. */
	public TextFieldStyle getStyle () {
<span class="nc" id="L227">		return style;</span>
	}

	protected void calculateOffsets () {
<span class="nc" id="L231">		float visibleWidth = getWidth();</span>
<span class="nc" id="L232">		Drawable background = getBackgroundDrawable();</span>
<span class="nc bnc" id="L233" title="All 2 branches missed.">		if (background != null) visibleWidth -= background.getLeftWidth() + background.getRightWidth();</span>

<span class="nc" id="L235">		int glyphCount = glyphPositions.size;</span>
<span class="nc" id="L236">		float[] glyphPositions = this.glyphPositions.items;</span>

		// Check if the cursor has gone out the left or right side of the visible area and adjust renderOffset.
<span class="nc" id="L239">		float distance = glyphPositions[Math.max(0, cursor - 1)] + renderOffset;</span>
<span class="nc bnc" id="L240" title="All 2 branches missed.">		if (distance &lt;= 0)</span>
<span class="nc" id="L241">			renderOffset -= distance;</span>
		else {
<span class="nc" id="L243">			int index = Math.min(glyphCount - 1, cursor + 1);</span>
<span class="nc" id="L244">			float minX = glyphPositions[index] - visibleWidth;</span>
<span class="nc bnc" id="L245" title="All 2 branches missed.">			if (-renderOffset &lt; minX) renderOffset = -minX;</span>
		}

		// Prevent renderOffset from starting too close to the end, eg after text was deleted.
<span class="nc" id="L249">		float maxOffset = 0;</span>
<span class="nc" id="L250">		float width = glyphPositions[glyphCount - 1];</span>
<span class="nc bnc" id="L251" title="All 2 branches missed.">		for (int i = glyphCount - 2; i &gt;= 0; i--) {</span>
<span class="nc" id="L252">			float x = glyphPositions[i];</span>
<span class="nc bnc" id="L253" title="All 2 branches missed.">			if (width - x &gt; visibleWidth) break;</span>
<span class="nc" id="L254">			maxOffset = x;</span>
		}
<span class="nc bnc" id="L256" title="All 2 branches missed.">		if (-renderOffset &gt; maxOffset) renderOffset = -maxOffset;</span>

		// calculate first visible char based on render offset
<span class="nc" id="L259">		visibleTextStart = 0;</span>
<span class="nc" id="L260">		float startX = 0;</span>
<span class="nc bnc" id="L261" title="All 2 branches missed.">		for (int i = 0; i &lt; glyphCount; i++) {</span>
<span class="nc bnc" id="L262" title="All 2 branches missed.">			if (glyphPositions[i] &gt;= -renderOffset) {</span>
<span class="nc" id="L263">				visibleTextStart = i;</span>
<span class="nc" id="L264">				startX = glyphPositions[i];</span>
<span class="nc" id="L265">				break;</span>
			}
		}

		// calculate last visible char based on visible width and render offset
<span class="nc" id="L270">		int end = visibleTextStart + 1;</span>
<span class="nc" id="L271">		float endX = visibleWidth - renderOffset;</span>
<span class="nc bnc" id="L272" title="All 2 branches missed.">		for (int n = Math.min(displayText.length(), glyphCount); end &lt;= n; end++)</span>
<span class="nc bnc" id="L273" title="All 2 branches missed.">			if (glyphPositions[end] &gt; endX) break;</span>
<span class="nc" id="L274">		visibleTextEnd = Math.max(0, end - 1);</span>

<span class="nc bnc" id="L276" title="All 2 branches missed.">		if ((textHAlign &amp; Align.left) == 0) {</span>
<span class="nc" id="L277">			textOffset = visibleWidth - glyphPositions[visibleTextEnd] - fontOffset + startX;</span>
<span class="nc bnc" id="L278" title="All 2 branches missed.">			if ((textHAlign &amp; Align.center) != 0) textOffset = Math.round(textOffset * 0.5f);</span>
		} else
<span class="nc" id="L280">			textOffset = startX + renderOffset;</span>

		// calculate selection x position and width
<span class="nc bnc" id="L283" title="All 2 branches missed.">		if (hasSelection) {</span>
<span class="nc" id="L284">			int minIndex = Math.min(cursor, selectionStart);</span>
<span class="nc" id="L285">			int maxIndex = Math.max(cursor, selectionStart);</span>
<span class="nc" id="L286">			float minX = Math.max(glyphPositions[minIndex] - glyphPositions[visibleTextStart], -textOffset);</span>
<span class="nc" id="L287">			float maxX = Math.min(glyphPositions[maxIndex] - glyphPositions[visibleTextStart], visibleWidth - textOffset);</span>
<span class="nc" id="L288">			selectionX = minX;</span>
<span class="nc" id="L289">			selectionWidth = maxX - minX - style.font.getData().cursorX;</span>
		}
<span class="nc" id="L291">	}</span>

	private Drawable getBackgroundDrawable () {
<span class="nc" id="L294">		boolean focused = hasKeyboardFocus();</span>
<span class="nc bnc" id="L295" title="All 4 branches missed.">		return (disabled &amp;&amp; style.disabledBackground != null) ? style.disabledBackground</span>
<span class="nc bnc" id="L296" title="All 4 branches missed.">			: ((focused &amp;&amp; style.focusedBackground != null) ? style.focusedBackground : style.background);</span>
	}

	public void draw (Batch batch, float parentAlpha) {
<span class="nc" id="L300">		boolean focused = hasKeyboardFocus();</span>
<span class="nc bnc" id="L301" title="All 2 branches missed.">		if (focused != this.focused) {</span>
<span class="nc" id="L302">			this.focused = focused;</span>
<span class="nc" id="L303">			blinkTask.cancel();</span>
<span class="nc" id="L304">			cursorOn = focused;</span>
<span class="nc bnc" id="L305" title="All 2 branches missed.">			if (focused)</span>
<span class="nc" id="L306">				Timer.schedule(blinkTask, blinkTime, blinkTime);</span>
			else
<span class="nc" id="L308">				keyRepeatTask.cancel();</span>
<span class="nc bnc" id="L309" title="All 2 branches missed.">		} else if (!focused) //</span>
<span class="nc" id="L310">			cursorOn = false;</span>

<span class="nc" id="L312">		final BitmapFont font = style.font;</span>
<span class="nc bnc" id="L313" title="All 4 branches missed.">		final Color fontColor = (disabled &amp;&amp; style.disabledFontColor != null) ? style.disabledFontColor</span>
<span class="nc bnc" id="L314" title="All 4 branches missed.">			: ((focused &amp;&amp; style.focusedFontColor != null) ? style.focusedFontColor : style.fontColor);</span>
<span class="nc" id="L315">		final Drawable selection = style.selection;</span>
<span class="nc" id="L316">		final Drawable cursorPatch = style.cursor;</span>
<span class="nc" id="L317">		final Drawable background = getBackgroundDrawable();</span>

<span class="nc" id="L319">		Color color = getColor();</span>
<span class="nc" id="L320">		float x = getX();</span>
<span class="nc" id="L321">		float y = getY();</span>
<span class="nc" id="L322">		float width = getWidth();</span>
<span class="nc" id="L323">		float height = getHeight();</span>

<span class="nc" id="L325">		batch.setColor(color.r, color.g, color.b, color.a * parentAlpha);</span>
<span class="nc" id="L326">		float bgLeftWidth = 0, bgRightWidth = 0;</span>
<span class="nc bnc" id="L327" title="All 2 branches missed.">		if (background != null) {</span>
<span class="nc" id="L328">			background.draw(batch, x, y, width, height);</span>
<span class="nc" id="L329">			bgLeftWidth = background.getLeftWidth();</span>
<span class="nc" id="L330">			bgRightWidth = background.getRightWidth();</span>
		}

<span class="nc" id="L333">		float textY = getTextY(font, background);</span>
<span class="nc" id="L334">		calculateOffsets();</span>

<span class="nc bnc" id="L336" title="All 6 branches missed.">		if (focused &amp;&amp; hasSelection &amp;&amp; selection != null) {</span>
<span class="nc" id="L337">			drawSelection(selection, batch, font, x + bgLeftWidth, y + textY);</span>
		}

<span class="nc bnc" id="L340" title="All 2 branches missed.">		float yOffset = font.isFlipped() ? -textHeight : 0;</span>
<span class="nc bnc" id="L341" title="All 2 branches missed.">		if (displayText.length() == 0) {</span>
<span class="nc bnc" id="L342" title="All 4 branches missed.">			if (!focused &amp;&amp; messageText != null) {</span>
<span class="nc bnc" id="L343" title="All 2 branches missed.">				BitmapFont messageFont = style.messageFont != null ? style.messageFont : font;</span>
<span class="nc bnc" id="L344" title="All 2 branches missed.">				if (style.messageFontColor != null) {</span>
<span class="nc" id="L345">					messageFont.setColor(style.messageFontColor.r, style.messageFontColor.g, style.messageFontColor.b,</span>
						style.messageFontColor.a * color.a * parentAlpha);
				} else
<span class="nc" id="L348">					messageFont.setColor(0.7f, 0.7f, 0.7f, color.a * parentAlpha);</span>
<span class="nc" id="L349">				drawMessageText(batch, messageFont, x + bgLeftWidth, y + textY + yOffset, width - bgLeftWidth - bgRightWidth);</span>
<span class="nc" id="L350">			}</span>
		} else {
<span class="nc" id="L352">			font.setColor(fontColor.r, fontColor.g, fontColor.b, fontColor.a * color.a * parentAlpha);</span>
<span class="nc" id="L353">			drawText(batch, font, x + bgLeftWidth, y + textY + yOffset);</span>
		}
<span class="nc bnc" id="L355" title="All 6 branches missed.">		if (!disabled &amp;&amp; cursorOn &amp;&amp; cursorPatch != null) {</span>
<span class="nc" id="L356">			drawCursor(cursorPatch, batch, font, x + bgLeftWidth, y + textY);</span>
		}
<span class="nc" id="L358">	}</span>

	protected float getTextY (BitmapFont font, Drawable background) {
<span class="nc" id="L361">		float height = getHeight();</span>
<span class="nc" id="L362">		float textY = textHeight / 2 + font.getDescent();</span>
<span class="nc bnc" id="L363" title="All 2 branches missed.">		if (background != null) {</span>
<span class="nc" id="L364">			float bottom = background.getBottomHeight();</span>
<span class="nc" id="L365">			textY = textY + (height - background.getTopHeight() - bottom) / 2 + bottom;</span>
<span class="nc" id="L366">		} else {</span>
<span class="nc" id="L367">			textY = textY + height / 2;</span>
		}
<span class="nc bnc" id="L369" title="All 2 branches missed.">		if (font.usesIntegerPositions()) textY = (int)textY;</span>
<span class="nc" id="L370">		return textY;</span>
	}

	/** Draws selection rectangle **/
	protected void drawSelection (Drawable selection, Batch batch, BitmapFont font, float x, float y) {
<span class="nc" id="L375">		selection.draw(batch, x + textOffset + selectionX + fontOffset, y - textHeight - font.getDescent(), selectionWidth,</span>
			textHeight);
<span class="nc" id="L377">	}</span>

	protected void drawText (Batch batch, BitmapFont font, float x, float y) {
<span class="nc" id="L380">		font.draw(batch, displayText, x + textOffset, y, visibleTextStart, visibleTextEnd, 0, Align.left, false);</span>
<span class="nc" id="L381">	}</span>

	protected void drawMessageText (Batch batch, BitmapFont font, float x, float y, float maxWidth) {
<span class="nc" id="L384">		font.draw(batch, messageText, x, y, 0, messageText.length(), maxWidth, textHAlign, false, &quot;...&quot;);</span>
<span class="nc" id="L385">	}</span>

	protected void drawCursor (Drawable cursorPatch, Batch batch, BitmapFont font, float x, float y) {
<span class="nc" id="L388">		cursorPatch.draw(batch,</span>
<span class="nc" id="L389">			x + textOffset + glyphPositions.get(cursor) - glyphPositions.get(visibleTextStart) + fontOffset + font.getData().cursorX,</span>
<span class="nc" id="L390">			y - textHeight - font.getDescent(), cursorPatch.getMinWidth(), textHeight);</span>
<span class="nc" id="L391">	}</span>

	void updateDisplayText () {
<span class="nc" id="L394">		BitmapFont font = style.font;</span>
<span class="nc" id="L395">		BitmapFontData data = font.getData();</span>
<span class="nc" id="L396">		String text = this.text;</span>
<span class="nc" id="L397">		int textLength = text.length();</span>

<span class="nc" id="L399">		StringBuilder buffer = new StringBuilder();</span>
<span class="nc bnc" id="L400" title="All 2 branches missed.">		for (int i = 0; i &lt; textLength; i++) {</span>
<span class="nc" id="L401">			char c = text.charAt(i);</span>
<span class="nc bnc" id="L402" title="All 2 branches missed.">			buffer.append(data.hasGlyph(c) ? c : ' ');</span>
		}
<span class="nc" id="L404">		String newDisplayText = buffer.toString();</span>

<span class="nc bnc" id="L406" title="All 4 branches missed.">		if (passwordMode &amp;&amp; data.hasGlyph(passwordCharacter)) {</span>
<span class="nc bnc" id="L407" title="All 2 branches missed.">			if (passwordBuffer == null) passwordBuffer = new StringBuilder(newDisplayText.length());</span>
<span class="nc bnc" id="L408" title="All 2 branches missed.">			if (passwordBuffer.length() &gt; textLength)</span>
<span class="nc" id="L409">				passwordBuffer.setLength(textLength);</span>
			else {
<span class="nc bnc" id="L411" title="All 2 branches missed.">				for (int i = passwordBuffer.length(); i &lt; textLength; i++)</span>
<span class="nc" id="L412">					passwordBuffer.append(passwordCharacter);</span>
			}
<span class="nc" id="L414">			displayText = passwordBuffer;</span>
		} else
<span class="nc" id="L416">			displayText = newDisplayText;</span>

<span class="nc" id="L418">		layout.setText(font, displayText.toString().replace('\r', ' ').replace('\n', ' '));</span>
<span class="nc" id="L419">		glyphPositions.clear();</span>
<span class="nc" id="L420">		float x = 0;</span>
<span class="nc bnc" id="L421" title="All 2 branches missed.">		if (layout.runs.size &gt; 0) {</span>
<span class="nc" id="L422">			GlyphRun run = layout.runs.first();</span>
<span class="nc" id="L423">			FloatArray xAdvances = run.xAdvances;</span>
<span class="nc" id="L424">			fontOffset = xAdvances.first();</span>
<span class="nc bnc" id="L425" title="All 2 branches missed.">			for (int i = 1, n = xAdvances.size; i &lt; n; i++) {</span>
<span class="nc" id="L426">				glyphPositions.add(x);</span>
<span class="nc" id="L427">				x += xAdvances.get(i);</span>
			}
<span class="nc" id="L429">		} else</span>
<span class="nc" id="L430">			fontOffset = 0;</span>
<span class="nc" id="L431">		glyphPositions.add(x);</span>

<span class="nc" id="L433">		visibleTextStart = Math.min(visibleTextStart, glyphPositions.size - 1);</span>
<span class="nc" id="L434">		visibleTextEnd = MathUtils.clamp(visibleTextEnd, visibleTextStart, glyphPositions.size - 1);</span>

<span class="nc bnc" id="L436" title="All 2 branches missed.">		if (selectionStart &gt; newDisplayText.length()) selectionStart = textLength;</span>
<span class="nc" id="L437">	}</span>

	/** Copies the contents of this TextField to the {@link Clipboard} implementation set on this TextField. */
	public void copy () {
<span class="nc bnc" id="L441" title="All 4 branches missed.">		if (hasSelection &amp;&amp; !passwordMode) {</span>
<span class="nc" id="L442">			clipboard.setContents(text.substring(Math.min(cursor, selectionStart), Math.max(cursor, selectionStart)));</span>
		}
<span class="nc" id="L444">	}</span>

	/** Copies the selected contents of this TextField to the {@link Clipboard} implementation set on this TextField, then removes
	 * it. */
	public void cut () {
<span class="nc" id="L449">		cut(programmaticChangeEvents);</span>
<span class="nc" id="L450">	}</span>

	void cut (boolean fireChangeEvent) {
<span class="nc bnc" id="L453" title="All 4 branches missed.">		if (hasSelection &amp;&amp; !passwordMode) {</span>
<span class="nc" id="L454">			copy();</span>
<span class="nc" id="L455">			cursor = delete(fireChangeEvent);</span>
<span class="nc" id="L456">			updateDisplayText();</span>
		}
<span class="nc" id="L458">	}</span>

	void paste (String content, boolean fireChangeEvent) {
<span class="nc bnc" id="L461" title="All 2 branches missed.">		if (content == null) return;</span>
<span class="nc" id="L462">		StringBuilder buffer = new StringBuilder();</span>
<span class="nc" id="L463">		int textLength = text.length();</span>
<span class="nc bnc" id="L464" title="All 2 branches missed.">		if (hasSelection) textLength -= Math.abs(cursor - selectionStart);</span>
<span class="nc" id="L465">		BitmapFontData data = style.font.getData();</span>
<span class="nc bnc" id="L466" title="All 2 branches missed.">		for (int i = 0, n = content.length(); i &lt; n; i++) {</span>
<span class="nc bnc" id="L467" title="All 2 branches missed.">			if (!withinMaxLength(textLength + buffer.length())) break;</span>
<span class="nc" id="L468">			char c = content.charAt(i);</span>
<span class="nc bnc" id="L469" title="All 6 branches missed.">			if (!(writeEnters &amp;&amp; (c == ENTER_ANDROID || c == ENTER_DESKTOP))) {</span>
<span class="nc bnc" id="L470" title="All 4 branches missed.">				if (c == '\r' || c == '\n') continue;</span>
<span class="nc bnc" id="L471" title="All 4 branches missed.">				if (onlyFontChars &amp;&amp; !data.hasGlyph(c)) continue;</span>
<span class="nc bnc" id="L472" title="All 4 branches missed.">				if (filter != null &amp;&amp; !filter.acceptChar(this, c)) continue;</span>
			}
<span class="nc" id="L474">			buffer.append(c);</span>
		}
<span class="nc" id="L476">		content = buffer.toString();</span>

<span class="nc bnc" id="L478" title="All 2 branches missed.">		if (hasSelection) cursor = delete(fireChangeEvent);</span>
<span class="nc bnc" id="L479" title="All 2 branches missed.">		if (fireChangeEvent)</span>
<span class="nc" id="L480">			changeText(text, insert(cursor, content, text));</span>
		else
<span class="nc" id="L482">			text = insert(cursor, content, text);</span>
<span class="nc" id="L483">		updateDisplayText();</span>
<span class="nc" id="L484">		cursor += content.length();</span>
<span class="nc" id="L485">	}</span>

	String insert (int position, CharSequence text, String to) {
<span class="nc bnc" id="L488" title="All 2 branches missed.">		if (to.length() == 0) return text.toString();</span>
<span class="nc" id="L489">		return to.substring(0, position) + text + to.substring(position, to.length());</span>
	}

	int delete (boolean fireChangeEvent) {
<span class="nc" id="L493">		int from = selectionStart;</span>
<span class="nc" id="L494">		int to = cursor;</span>
<span class="nc" id="L495">		int minIndex = Math.min(from, to);</span>
<span class="nc" id="L496">		int maxIndex = Math.max(from, to);</span>
<span class="nc bnc" id="L497" title="All 2 branches missed.">		String newText = (minIndex &gt; 0 ? text.substring(0, minIndex) : &quot;&quot;)</span>
<span class="nc bnc" id="L498" title="All 2 branches missed.">			+ (maxIndex &lt; text.length() ? text.substring(maxIndex, text.length()) : &quot;&quot;);</span>
<span class="nc bnc" id="L499" title="All 2 branches missed.">		if (fireChangeEvent)</span>
<span class="nc" id="L500">			changeText(text, newText);</span>
		else
<span class="nc" id="L502">			text = newText;</span>
<span class="nc" id="L503">		clearSelection();</span>
<span class="nc" id="L504">		return minIndex;</span>
	}

	/** Focuses the next TextField. If none is found, the keyboard is hidden. Does nothing if the text field is not in a stage.
	 * @param up If true, the TextField with the same or next smallest y coordinate is found, else the next highest. */
	public void next (boolean up) {
<span class="nc" id="L510">		Stage stage = getStage();</span>
<span class="nc bnc" id="L511" title="All 2 branches missed.">		if (stage == null) return;</span>
<span class="nc" id="L512">		TextField current = this;</span>
<span class="nc" id="L513">		Vector2 currentCoords = current.getParent().localToStageCoordinates(tmp2.set(current.getX(), current.getY()));</span>
<span class="nc" id="L514">		Vector2 bestCoords = tmp1;</span>
		while (true) {
<span class="nc" id="L516">			TextField textField = current.findNextTextField(stage.getActors(), null, bestCoords, currentCoords, up);</span>
<span class="nc bnc" id="L517" title="All 2 branches missed.">			if (textField == null) { // Try to wrap around.</span>
<span class="nc bnc" id="L518" title="All 2 branches missed.">				if (up)</span>
<span class="nc" id="L519">					currentCoords.set(-Float.MAX_VALUE, -Float.MAX_VALUE);</span>
				else
<span class="nc" id="L521">					currentCoords.set(Float.MAX_VALUE, Float.MAX_VALUE);</span>
<span class="nc" id="L522">				textField = current.findNextTextField(stage.getActors(), null, bestCoords, currentCoords, up);</span>
			}
<span class="nc bnc" id="L524" title="All 2 branches missed.">			if (textField == null) {</span>
<span class="nc" id="L525">				Gdx.input.setOnscreenKeyboardVisible(false);</span>
<span class="nc" id="L526">				break;</span>
			}
<span class="nc bnc" id="L528" title="All 2 branches missed.">			if (stage.setKeyboardFocus(textField)) {</span>
<span class="nc" id="L529">				textField.selectAll();</span>
<span class="nc" id="L530">				break;</span>
			}
<span class="nc" id="L532">			current = textField;</span>
<span class="nc" id="L533">			currentCoords.set(bestCoords);</span>
<span class="nc" id="L534">		}</span>
<span class="nc" id="L535">	}</span>

	/** @return May be null. */
	private TextField findNextTextField (Array&lt;Actor&gt; actors, TextField best, Vector2 bestCoords, Vector2 currentCoords,
		boolean up) {
<span class="nc bnc" id="L540" title="All 2 branches missed.">		for (int i = 0, n = actors.size; i &lt; n; i++) {</span>
<span class="nc" id="L541">			Actor actor = actors.get(i);</span>
<span class="nc bnc" id="L542" title="All 2 branches missed.">			if (actor instanceof TextField) {</span>
<span class="nc bnc" id="L543" title="All 2 branches missed.">				if (actor == this) continue;</span>
<span class="nc" id="L544">				TextField textField = (TextField)actor;</span>
<span class="nc bnc" id="L545" title="All 6 branches missed.">				if (textField.isDisabled() || !textField.focusTraversal || !textField.ancestorsVisible()) continue;</span>
<span class="nc" id="L546">				Vector2 actorCoords = actor.getParent().localToStageCoordinates(tmp3.set(actor.getX(), actor.getY()));</span>
<span class="nc bnc" id="L547" title="All 6 branches missed.">				boolean below = actorCoords.y != currentCoords.y &amp;&amp; (actorCoords.y &lt; currentCoords.y ^ up);</span>
<span class="nc bnc" id="L548" title="All 6 branches missed.">				boolean right = actorCoords.y == currentCoords.y &amp;&amp; (actorCoords.x &gt; currentCoords.x ^ up);</span>
<span class="nc bnc" id="L549" title="All 4 branches missed.">				if (!below &amp;&amp; !right) continue;</span>
<span class="nc bnc" id="L550" title="All 8 branches missed.">				boolean better = best == null || (actorCoords.y != bestCoords.y &amp;&amp; (actorCoords.y &gt; bestCoords.y ^ up));</span>
<span class="nc bnc" id="L551" title="All 8 branches missed.">				if (!better) better = actorCoords.y == bestCoords.y &amp;&amp; (actorCoords.x &lt; bestCoords.x ^ up);</span>
<span class="nc bnc" id="L552" title="All 2 branches missed.">				if (better) {</span>
<span class="nc" id="L553">					best = (TextField)actor;</span>
<span class="nc" id="L554">					bestCoords.set(actorCoords);</span>
				}
<span class="nc bnc" id="L556" title="All 2 branches missed.">			} else if (actor instanceof Group)</span>
<span class="nc" id="L557">				best = findNextTextField(((Group)actor).getChildren(), best, bestCoords, currentCoords, up);</span>
		}
<span class="nc" id="L559">		return best;</span>
	}

	public InputListener getDefaultInputListener () {
<span class="nc" id="L563">		return inputListener;</span>
	}

	/** @param listener May be null. */
	public void setTextFieldListener (TextFieldListener listener) {
<span class="nc" id="L568">		this.listener = listener;</span>
<span class="nc" id="L569">	}</span>

	/** @param filter May be null. */
	public void setTextFieldFilter (TextFieldFilter filter) {
<span class="nc" id="L573">		this.filter = filter;</span>
<span class="nc" id="L574">	}</span>

	public TextFieldFilter getTextFieldFilter () {
<span class="nc" id="L577">		return filter;</span>
	}

	/** If true (the default), tab/shift+tab will move to the next text field. */
	public void setFocusTraversal (boolean focusTraversal) {
<span class="nc" id="L582">		this.focusTraversal = focusTraversal;</span>
<span class="nc" id="L583">	}</span>

	/** @return May be null. */
	public String getMessageText () {
<span class="nc" id="L587">		return messageText;</span>
	}

	/** Sets the text that will be drawn in the text field if no text has been entered.
	 * @param messageText may be null. */
	public void setMessageText (String messageText) {
<span class="nc" id="L593">		this.messageText = messageText;</span>
<span class="nc" id="L594">	}</span>

	/** @param str If null, &quot;&quot; is used. */
	public void appendText (String str) {
<span class="nc bnc" id="L598" title="All 2 branches missed.">		if (str == null) str = &quot;&quot;;</span>

<span class="nc" id="L600">		clearSelection();</span>
<span class="nc" id="L601">		cursor = text.length();</span>
<span class="nc" id="L602">		paste(str, programmaticChangeEvents);</span>
<span class="nc" id="L603">	}</span>

	/** @param str If null, &quot;&quot; is used. */
	public void setText (String str) {
<span class="nc bnc" id="L607" title="All 2 branches missed.">		if (str == null) str = &quot;&quot;;</span>
<span class="nc bnc" id="L608" title="All 2 branches missed.">		if (str.equals(text)) return;</span>

<span class="nc" id="L610">		clearSelection();</span>
<span class="nc" id="L611">		String oldText = text;</span>
<span class="nc" id="L612">		text = &quot;&quot;;</span>
<span class="nc" id="L613">		paste(str, false);</span>
<span class="nc bnc" id="L614" title="All 2 branches missed.">		if (programmaticChangeEvents) changeText(oldText, text);</span>
<span class="nc" id="L615">		cursor = 0;</span>
<span class="nc" id="L616">	}</span>

	/** @return Never null, might be an empty string. */
	public String getText () {
<span class="nc" id="L620">		return text;</span>
	}

	/** @param oldText May be null.
	 * @return True if the text was changed. */
	boolean changeText (String oldText, String newText) {
<span class="nc bnc" id="L626" title="All 2 branches missed.">		if (newText.equals(oldText)) return false;</span>
<span class="nc" id="L627">		text = newText;</span>
<span class="nc" id="L628">		ChangeEvent changeEvent = Pools.obtain(ChangeEvent.class);</span>
<span class="nc" id="L629">		boolean cancelled = fire(changeEvent);</span>
<span class="nc bnc" id="L630" title="All 2 branches missed.">		text = cancelled ? oldText : newText;</span>
<span class="nc" id="L631">		Pools.free(changeEvent);</span>
<span class="nc bnc" id="L632" title="All 2 branches missed.">		return !cancelled;</span>
	}

	/** If false, methods that change the text will not fire {@link ChangeEvent}, the event will be fired only when user changes
	 * the text. */
	public void setProgrammaticChangeEvents (boolean programmaticChangeEvents) {
<span class="nc" id="L638">		this.programmaticChangeEvents = programmaticChangeEvents;</span>
<span class="nc" id="L639">	}</span>

	public boolean getProgrammaticChangeEvents () {
<span class="nc" id="L642">		return programmaticChangeEvents;</span>
	}

	public int getSelectionStart () {
<span class="nc" id="L646">		return selectionStart;</span>
	}

	public String getSelection () {
<span class="nc bnc" id="L650" title="All 2 branches missed.">		return hasSelection ? text.substring(Math.min(selectionStart, cursor), Math.max(selectionStart, cursor)) : &quot;&quot;;</span>
	}

	/** Sets the selected text. */
	public void setSelection (int selectionStart, int selectionEnd) {
<span class="nc bnc" id="L655" title="All 2 branches missed.">		if (selectionStart &lt; 0) throw new IllegalArgumentException(&quot;selectionStart must be &gt;= 0&quot;);</span>
<span class="nc bnc" id="L656" title="All 2 branches missed.">		if (selectionEnd &lt; 0) throw new IllegalArgumentException(&quot;selectionEnd must be &gt;= 0&quot;);</span>
<span class="nc" id="L657">		selectionStart = Math.min(text.length(), selectionStart);</span>
<span class="nc" id="L658">		selectionEnd = Math.min(text.length(), selectionEnd);</span>
<span class="nc bnc" id="L659" title="All 2 branches missed.">		if (selectionEnd == selectionStart) {</span>
<span class="nc" id="L660">			clearSelection();</span>
<span class="nc" id="L661">			return;</span>
		}
<span class="nc bnc" id="L663" title="All 2 branches missed.">		if (selectionEnd &lt; selectionStart) {</span>
<span class="nc" id="L664">			int temp = selectionEnd;</span>
<span class="nc" id="L665">			selectionEnd = selectionStart;</span>
<span class="nc" id="L666">			selectionStart = temp;</span>
		}

<span class="nc" id="L669">		hasSelection = true;</span>
<span class="nc" id="L670">		this.selectionStart = selectionStart;</span>
<span class="nc" id="L671">		cursor = selectionEnd;</span>
<span class="nc" id="L672">	}</span>

	public void selectAll () {
<span class="nc" id="L675">		setSelection(0, text.length());</span>
<span class="nc" id="L676">	}</span>

	public void clearSelection () {
<span class="nc" id="L679">		hasSelection = false;</span>
<span class="nc" id="L680">	}</span>

	/** Sets the cursor position and clears any selection. */
	public void setCursorPosition (int cursorPosition) {
<span class="nc bnc" id="L684" title="All 2 branches missed.">		if (cursorPosition &lt; 0) throw new IllegalArgumentException(&quot;cursorPosition must be &gt;= 0&quot;);</span>
<span class="nc" id="L685">		clearSelection();</span>
<span class="nc" id="L686">		cursor = Math.min(cursorPosition, text.length());</span>
<span class="nc" id="L687">	}</span>

	public int getCursorPosition () {
<span class="nc" id="L690">		return cursor;</span>
	}

	/** Default is an instance of {@link DefaultOnscreenKeyboard}. */
	public OnscreenKeyboard getOnscreenKeyboard () {
<span class="nc" id="L695">		return keyboard;</span>
	}

	public void setOnscreenKeyboard (OnscreenKeyboard keyboard) {
<span class="nc" id="L699">		this.keyboard = keyboard;</span>
<span class="nc" id="L700">	}</span>

	public void setClipboard (Clipboard clipboard) {
<span class="nc" id="L703">		this.clipboard = clipboard;</span>
<span class="nc" id="L704">	}</span>

	public float getPrefWidth () {
<span class="nc" id="L707">		return 150;</span>
	}

	public float getPrefHeight () {
<span class="nc" id="L711">		float topAndBottom = 0, minHeight = 0;</span>
<span class="nc bnc" id="L712" title="All 2 branches missed.">		if (style.background != null) {</span>
<span class="nc" id="L713">			topAndBottom = Math.max(topAndBottom, style.background.getBottomHeight() + style.background.getTopHeight());</span>
<span class="nc" id="L714">			minHeight = Math.max(minHeight, style.background.getMinHeight());</span>
		}
<span class="nc bnc" id="L716" title="All 2 branches missed.">		if (style.focusedBackground != null) {</span>
<span class="nc" id="L717">			topAndBottom = Math.max(topAndBottom,</span>
<span class="nc" id="L718">				style.focusedBackground.getBottomHeight() + style.focusedBackground.getTopHeight());</span>
<span class="nc" id="L719">			minHeight = Math.max(minHeight, style.focusedBackground.getMinHeight());</span>
		}
<span class="nc bnc" id="L721" title="All 2 branches missed.">		if (style.disabledBackground != null) {</span>
<span class="nc" id="L722">			topAndBottom = Math.max(topAndBottom,</span>
<span class="nc" id="L723">				style.disabledBackground.getBottomHeight() + style.disabledBackground.getTopHeight());</span>
<span class="nc" id="L724">			minHeight = Math.max(minHeight, style.disabledBackground.getMinHeight());</span>
		}
<span class="nc" id="L726">		return Math.max(topAndBottom + textHeight, minHeight);</span>
	}

	/** Sets text horizontal alignment (left, center or right).
	 * @see Align */
	public void setAlignment (int alignment) {
<span class="nc" id="L732">		this.textHAlign = alignment;</span>
<span class="nc" id="L733">	}</span>

	public int getAlignment () {
<span class="nc" id="L736">		return textHAlign;</span>
	}

	/** If true, the text in this text field will be shown as bullet characters.
	 * @see #setPasswordCharacter(char) */
	public void setPasswordMode (boolean passwordMode) {
<span class="nc" id="L742">		this.passwordMode = passwordMode;</span>
<span class="nc" id="L743">		updateDisplayText();</span>
<span class="nc" id="L744">	}</span>

	public boolean isPasswordMode () {
<span class="nc" id="L747">		return passwordMode;</span>
	}

	/** Sets the password character for the text field. The character must be present in the {@link BitmapFont}. Default is 149
	 * (bullet). */
	public void setPasswordCharacter (char passwordCharacter) {
<span class="nc" id="L753">		this.passwordCharacter = passwordCharacter;</span>
<span class="nc bnc" id="L754" title="All 2 branches missed.">		if (passwordMode) updateDisplayText();</span>
<span class="nc" id="L755">	}</span>

	public void setBlinkTime (float blinkTime) {
<span class="nc" id="L758">		this.blinkTime = blinkTime;</span>
<span class="nc" id="L759">	}</span>

	public void setDisabled (boolean disabled) {
<span class="nc" id="L762">		this.disabled = disabled;</span>
<span class="nc" id="L763">	}</span>

	public boolean isDisabled () {
<span class="nc" id="L766">		return disabled;</span>
	}

	protected void moveCursor (boolean forward, boolean jump) {
<span class="nc bnc" id="L770" title="All 2 branches missed.">		int limit = forward ? text.length() : 0;</span>
<span class="nc bnc" id="L771" title="All 2 branches missed.">		int charOffset = forward ? 0 : -1;</span>
<span class="nc bnc" id="L772" title="All 8 branches missed.">		while ((forward ? ++cursor &lt; limit : --cursor &gt; limit) &amp;&amp; jump) {</span>
<span class="nc bnc" id="L773" title="All 2 branches missed.">			if (!continueCursor(cursor, charOffset)) break;</span>
		}
<span class="nc" id="L775">	}</span>

	protected boolean continueCursor (int index, int offset) {
<span class="nc" id="L778">		char c = text.charAt(index + offset);</span>
<span class="nc" id="L779">		return isWordCharacter(c);</span>
	}

<span class="nc" id="L782">	class KeyRepeatTask extends Task {</span>
		int keycode;

		public void run () {
<span class="nc bnc" id="L786" title="All 2 branches missed.">			if (getStage() == null) {</span>
<span class="nc" id="L787">				cancel();</span>
<span class="nc" id="L788">				return;</span>
			}
<span class="nc" id="L790">			inputListener.keyDown(null, keycode);</span>
<span class="nc" id="L791">		}</span>
	}

	/** Interface for listening to typed characters.
	 * @author mzechner */
	static public interface TextFieldListener {
		public void keyTyped (TextField textField, char c);
	}

	/** Interface for filtering characters entered into the text field.
	 * @author mzechner */
	static public interface TextFieldFilter {
		public boolean acceptChar (TextField textField, char c);

<span class="nc" id="L805">		static public class DigitsOnlyFilter implements TextFieldFilter {</span>
			public boolean acceptChar (TextField textField, char c) {
<span class="nc" id="L807">				return Character.isDigit(c);</span>
			}
		}
	}

	/** An interface for onscreen keyboards. Can invoke the default keyboard or render your own keyboard!
	 * @author mzechner */
	static public interface OnscreenKeyboard {
		public void show (boolean visible);
	}

	/** The default {@link OnscreenKeyboard} used by all {@link TextField} instances. Just uses
	 * {@link Input#setOnscreenKeyboardVisible(boolean)} as appropriate. Might overlap your actual rendering, so use with care!
	 * @author mzechner */
<span class="nc" id="L821">	static public class DefaultOnscreenKeyboard implements OnscreenKeyboard {</span>
		public void show (boolean visible) {
<span class="nc" id="L823">			Gdx.input.setOnscreenKeyboardVisible(visible);</span>
<span class="nc" id="L824">		}</span>
	}

	/** Basic input listener for the text field */
<span class="nc" id="L828">	public class TextFieldClickListener extends ClickListener {</span>
		public void clicked (InputEvent event, float x, float y) {
<span class="nc" id="L830">			int count = getTapCount() % 4;</span>
<span class="nc bnc" id="L831" title="All 2 branches missed.">			if (count == 0) clearSelection();</span>
<span class="nc bnc" id="L832" title="All 2 branches missed.">			if (count == 2) {</span>
<span class="nc" id="L833">				int[] array = wordUnderCursor(x);</span>
<span class="nc" id="L834">				setSelection(array[0], array[1]);</span>
			}
<span class="nc bnc" id="L836" title="All 2 branches missed.">			if (count == 3) selectAll();</span>
<span class="nc" id="L837">		}</span>

		public boolean touchDown (InputEvent event, float x, float y, int pointer, int button) {
<span class="nc bnc" id="L840" title="All 2 branches missed.">			if (!super.touchDown(event, x, y, pointer, button)) return false;</span>
<span class="nc bnc" id="L841" title="All 4 branches missed.">			if (pointer == 0 &amp;&amp; button != 0) return false;</span>
<span class="nc bnc" id="L842" title="All 2 branches missed.">			if (disabled) return true;</span>
<span class="nc" id="L843">			setCursorPosition(x, y);</span>
<span class="nc" id="L844">			selectionStart = cursor;</span>
<span class="nc" id="L845">			Stage stage = getStage();</span>
<span class="nc bnc" id="L846" title="All 2 branches missed.">			if (stage != null) stage.setKeyboardFocus(TextField.this);</span>
<span class="nc" id="L847">			keyboard.show(true);</span>
<span class="nc" id="L848">			hasSelection = true;</span>
<span class="nc" id="L849">			return true;</span>
		}

		public void touchDragged (InputEvent event, float x, float y, int pointer) {
<span class="nc" id="L853">			super.touchDragged(event, x, y, pointer);</span>
<span class="nc" id="L854">			setCursorPosition(x, y);</span>
<span class="nc" id="L855">		}</span>

		public void touchUp (InputEvent event, float x, float y, int pointer, int button) {
<span class="nc bnc" id="L858" title="All 2 branches missed.">			if (selectionStart == cursor) hasSelection = false;</span>
<span class="nc" id="L859">			super.touchUp(event, x, y, pointer, button);</span>
<span class="nc" id="L860">		}</span>

		protected void setCursorPosition (float x, float y) {
<span class="nc" id="L863">			cursor = letterUnderCursor(x);</span>

<span class="nc" id="L865">			cursorOn = focused;</span>
<span class="nc" id="L866">			blinkTask.cancel();</span>
<span class="nc bnc" id="L867" title="All 2 branches missed.">			if (focused) Timer.schedule(blinkTask, blinkTime, blinkTime);</span>
<span class="nc" id="L868">		}</span>

		protected void goHome (boolean jump) {
<span class="nc" id="L871">			cursor = 0;</span>
<span class="nc" id="L872">		}</span>

		protected void goEnd (boolean jump) {
<span class="nc" id="L875">			cursor = text.length();</span>
<span class="nc" id="L876">		}</span>

		public boolean keyDown (InputEvent event, int keycode) {
<span class="nc bnc" id="L879" title="All 2 branches missed.">			if (disabled) return false;</span>

<span class="nc" id="L881">			cursorOn = focused;</span>
<span class="nc" id="L882">			blinkTask.cancel();</span>
<span class="nc bnc" id="L883" title="All 2 branches missed.">			if (focused) Timer.schedule(blinkTask, blinkTime, blinkTime);</span>

<span class="nc bnc" id="L885" title="All 2 branches missed.">			if (!hasKeyboardFocus()) return false;</span>

<span class="nc" id="L887">			boolean repeat = false;</span>
<span class="nc" id="L888">			boolean ctrl = UIUtils.ctrl();</span>
<span class="nc bnc" id="L889" title="All 4 branches missed.">			boolean jump = ctrl &amp;&amp; !passwordMode;</span>
<span class="nc" id="L890">			boolean handled = true;</span>

<span class="nc bnc" id="L892" title="All 2 branches missed.">			if (ctrl) {</span>
<span class="nc bnc" id="L893" title="All 6 branches missed.">				switch (keycode) {</span>
				case Keys.V:
<span class="nc" id="L895">					paste(clipboard.getContents(), true);</span>
<span class="nc" id="L896">					repeat = true;</span>
<span class="nc" id="L897">					break;</span>
				case Keys.C:
				case Keys.INSERT:
<span class="nc" id="L900">					copy();</span>
<span class="nc" id="L901">					return true;</span>
				case Keys.X:
<span class="nc" id="L903">					cut(true);</span>
<span class="nc" id="L904">					return true;</span>
				case Keys.A:
<span class="nc" id="L906">					selectAll();</span>
<span class="nc" id="L907">					return true;</span>
				case Keys.Z:
<span class="nc" id="L909">					String oldText = text;</span>
<span class="nc" id="L910">					setText(undoText);</span>
<span class="nc" id="L911">					undoText = oldText;</span>
<span class="nc" id="L912">					updateDisplayText();</span>
<span class="nc" id="L913">					return true;</span>
				default:
<span class="nc" id="L915">					handled = false;</span>
				}
			}

<span class="nc bnc" id="L919" title="All 2 branches missed.">			if (UIUtils.shift()) {</span>
<span class="nc bnc" id="L920" title="All 3 branches missed.">				switch (keycode) {</span>
				case Keys.INSERT:
<span class="nc" id="L922">					paste(clipboard.getContents(), true);</span>
<span class="nc" id="L923">					break;</span>
				case Keys.FORWARD_DEL:
<span class="nc" id="L925">					cut(true);</span>
					break;
				}

				selection:
				{
<span class="nc" id="L931">					int temp = cursor;</span>
					keys:
					{
<span class="nc bnc" id="L934" title="All 5 branches missed.">						switch (keycode) {</span>
						case Keys.LEFT:
<span class="nc" id="L936">							moveCursor(false, jump);</span>
<span class="nc" id="L937">							repeat = true;</span>
<span class="nc" id="L938">							handled = true;</span>
<span class="nc" id="L939">							break keys;</span>
						case Keys.RIGHT:
<span class="nc" id="L941">							moveCursor(true, jump);</span>
<span class="nc" id="L942">							repeat = true;</span>
<span class="nc" id="L943">							handled = true;</span>
<span class="nc" id="L944">							break keys;</span>
						case Keys.HOME:
<span class="nc" id="L946">							goHome(jump);</span>
<span class="nc" id="L947">							handled = true;</span>
<span class="nc" id="L948">							break keys;</span>
						case Keys.END:
<span class="nc" id="L950">							goEnd(jump);</span>
<span class="nc" id="L951">							handled = true;</span>
<span class="nc" id="L952">							break keys;</span>
						}
<span class="nc" id="L954">						break selection;</span>
					}
<span class="nc bnc" id="L956" title="All 2 branches missed.">					if (!hasSelection) {</span>
<span class="nc" id="L957">						selectionStart = temp;</span>
<span class="nc" id="L958">						hasSelection = true;</span>
					}
<span class="nc" id="L960">				}</span>
			} else {
				// Cursor movement or other keys (kills selection).
<span class="nc bnc" id="L963" title="All 5 branches missed.">				switch (keycode) {</span>
				case Keys.LEFT:
<span class="nc" id="L965">					moveCursor(false, jump);</span>
<span class="nc" id="L966">					clearSelection();</span>
<span class="nc" id="L967">					repeat = true;</span>
<span class="nc" id="L968">					handled = true;</span>
<span class="nc" id="L969">					break;</span>
				case Keys.RIGHT:
<span class="nc" id="L971">					moveCursor(true, jump);</span>
<span class="nc" id="L972">					clearSelection();</span>
<span class="nc" id="L973">					repeat = true;</span>
<span class="nc" id="L974">					handled = true;</span>
<span class="nc" id="L975">					break;</span>
				case Keys.HOME:
<span class="nc" id="L977">					goHome(jump);</span>
<span class="nc" id="L978">					clearSelection();</span>
<span class="nc" id="L979">					handled = true;</span>
<span class="nc" id="L980">					break;</span>
				case Keys.END:
<span class="nc" id="L982">					goEnd(jump);</span>
<span class="nc" id="L983">					clearSelection();</span>
<span class="nc" id="L984">					handled = true;</span>
					break;
				}
			}

<span class="nc" id="L989">			cursor = MathUtils.clamp(cursor, 0, text.length());</span>

<span class="nc bnc" id="L991" title="All 2 branches missed.">			if (repeat) scheduleKeyRepeatTask(keycode);</span>
<span class="nc" id="L992">			return handled;</span>
		}

		protected void scheduleKeyRepeatTask (int keycode) {
<span class="nc bnc" id="L996" title="All 4 branches missed.">			if (!keyRepeatTask.isScheduled() || keyRepeatTask.keycode != keycode) {</span>
<span class="nc" id="L997">				keyRepeatTask.keycode = keycode;</span>
<span class="nc" id="L998">				keyRepeatTask.cancel();</span>
<span class="nc" id="L999">				Timer.schedule(keyRepeatTask, keyRepeatInitialTime, keyRepeatTime);</span>
			}
<span class="nc" id="L1001">		}</span>

		public boolean keyUp (InputEvent event, int keycode) {
<span class="nc bnc" id="L1004" title="All 2 branches missed.">			if (disabled) return false;</span>
<span class="nc" id="L1005">			keyRepeatTask.cancel();</span>
<span class="nc" id="L1006">			return true;</span>
		}

		public boolean keyTyped (InputEvent event, char character) {
<span class="nc bnc" id="L1010" title="All 2 branches missed.">			if (disabled) return false;</span>

			// Disallow &quot;typing&quot; most ASCII control characters, which would show up as a space when onlyFontChars is true.
<span class="nc bnc" id="L1013" title="All 2 branches missed.">			switch (character) {</span>
			case BACKSPACE:
			case TAB:
			case ENTER_ANDROID:
			case ENTER_DESKTOP:
<span class="nc" id="L1018">				break;</span>
			default:
<span class="nc bnc" id="L1020" title="All 2 branches missed.">				if (character &lt; 32) return false;</span>
			}

<span class="nc bnc" id="L1023" title="All 2 branches missed.">			if (!hasKeyboardFocus()) return false;</span>

<span class="nc bnc" id="L1025" title="All 4 branches missed.">			if (UIUtils.isMac &amp;&amp; Gdx.input.isKeyPressed(Keys.SYM)) return true;</span>

<span class="nc bnc" id="L1027" title="All 6 branches missed.">			if ((character == TAB || character == ENTER_ANDROID) &amp;&amp; focusTraversal) {</span>
<span class="nc" id="L1028">				next(UIUtils.shift());</span>
			} else {
<span class="nc bnc" id="L1030" title="All 2 branches missed.">				boolean delete = character == DELETE;</span>
<span class="nc bnc" id="L1031" title="All 2 branches missed.">				boolean backspace = character == BACKSPACE;</span>
<span class="nc bnc" id="L1032" title="All 4 branches missed.">				boolean enter = character == ENTER_DESKTOP || character == ENTER_ANDROID;</span>
<span class="nc bnc" id="L1033" title="All 6 branches missed.">				boolean add = enter ? writeEnters : (!onlyFontChars || style.font.getData().hasGlyph(character));</span>
<span class="nc bnc" id="L1034" title="All 4 branches missed.">				boolean remove = backspace || delete;</span>
<span class="nc bnc" id="L1035" title="All 4 branches missed.">				if (add || remove) {</span>
<span class="nc" id="L1036">					String oldText = text;</span>
<span class="nc" id="L1037">					int oldCursor = cursor;</span>
<span class="nc bnc" id="L1038" title="All 2 branches missed.">					if (remove) {</span>
<span class="nc bnc" id="L1039" title="All 2 branches missed.">						if (hasSelection)</span>
<span class="nc" id="L1040">							cursor = delete(false);</span>
						else {
<span class="nc bnc" id="L1042" title="All 4 branches missed.">							if (backspace &amp;&amp; cursor &gt; 0) {</span>
<span class="nc" id="L1043">								text = text.substring(0, cursor - 1) + text.substring(cursor--);</span>
<span class="nc" id="L1044">								renderOffset = 0;</span>
							}
<span class="nc bnc" id="L1046" title="All 4 branches missed.">							if (delete &amp;&amp; cursor &lt; text.length()) {</span>
<span class="nc" id="L1047">								text = text.substring(0, cursor) + text.substring(cursor + 1);</span>
							}
						}
					}
<span class="nc bnc" id="L1051" title="All 4 branches missed.">					if (add &amp;&amp; !remove) {</span>
						// Character may be added to the text.
<span class="nc bnc" id="L1053" title="All 6 branches missed.">						if (!enter &amp;&amp; filter != null &amp;&amp; !filter.acceptChar(TextField.this, character)) return true;</span>
<span class="nc bnc" id="L1054" title="All 2 branches missed.">						if (!withinMaxLength(text.length())) return true;</span>
<span class="nc bnc" id="L1055" title="All 2 branches missed.">						if (hasSelection) cursor = delete(false);</span>
<span class="nc bnc" id="L1056" title="All 2 branches missed.">						String insertion = enter ? &quot;\n&quot; : String.valueOf(character);</span>
<span class="nc" id="L1057">						text = insert(cursor++, insertion, text);</span>
					}
<span class="nc" id="L1059">					String tempUndoText = undoText;</span>
<span class="nc bnc" id="L1060" title="All 2 branches missed.">					if (changeText(oldText, text)) {</span>
<span class="nc" id="L1061">						long time = System.currentTimeMillis();</span>
<span class="nc bnc" id="L1062" title="All 2 branches missed.">						if (time - 750 &gt; lastChangeTime) undoText = oldText;</span>
<span class="nc" id="L1063">						lastChangeTime = time;</span>
<span class="nc" id="L1064">					} else</span>
<span class="nc" id="L1065">						cursor = oldCursor;</span>
<span class="nc" id="L1066">					updateDisplayText();</span>
				}
			}
<span class="nc bnc" id="L1069" title="All 2 branches missed.">			if (listener != null) listener.keyTyped(TextField.this, character);</span>
<span class="nc" id="L1070">			return true;</span>
		}
	}

	/** The style for a text field, see {@link TextField}.
	 * @author mzechner
	 * @author Nathan Sweet */
	static public class TextFieldStyle {
		public BitmapFont font;
		public Color fontColor;
		/** Optional. */
		public Color focusedFontColor, disabledFontColor;
		/** Optional. */
		public Drawable background, focusedBackground, disabledBackground, cursor, selection;
		/** Optional. */
		public BitmapFont messageFont;
		/** Optional. */
		public Color messageFontColor;

<span class="nc" id="L1089">		public TextFieldStyle () {</span>
<span class="nc" id="L1090">		}</span>

<span class="nc" id="L1092">		public TextFieldStyle (BitmapFont font, Color fontColor, Drawable cursor, Drawable selection, Drawable background) {</span>
<span class="nc" id="L1093">			this.background = background;</span>
<span class="nc" id="L1094">			this.cursor = cursor;</span>
<span class="nc" id="L1095">			this.font = font;</span>
<span class="nc" id="L1096">			this.fontColor = fontColor;</span>
<span class="nc" id="L1097">			this.selection = selection;</span>
<span class="nc" id="L1098">		}</span>

<span class="nc" id="L1100">		public TextFieldStyle (TextFieldStyle style) {</span>
<span class="nc" id="L1101">			this.messageFont = style.messageFont;</span>
<span class="nc bnc" id="L1102" title="All 2 branches missed.">			if (style.messageFontColor != null) this.messageFontColor = new Color(style.messageFontColor);</span>
<span class="nc" id="L1103">			this.background = style.background;</span>
<span class="nc" id="L1104">			this.focusedBackground = style.focusedBackground;</span>
<span class="nc" id="L1105">			this.disabledBackground = style.disabledBackground;</span>
<span class="nc" id="L1106">			this.cursor = style.cursor;</span>
<span class="nc" id="L1107">			this.font = style.font;</span>
<span class="nc bnc" id="L1108" title="All 2 branches missed.">			if (style.fontColor != null) this.fontColor = new Color(style.fontColor);</span>
<span class="nc bnc" id="L1109" title="All 2 branches missed.">			if (style.focusedFontColor != null) this.focusedFontColor = new Color(style.focusedFontColor);</span>
<span class="nc bnc" id="L1110" title="All 2 branches missed.">			if (style.disabledFontColor != null) this.disabledFontColor = new Color(style.disabledFontColor);</span>
<span class="nc" id="L1111">			this.selection = style.selection;</span>
<span class="nc" id="L1112">		}</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.4.201905082037</span></div></body></html>